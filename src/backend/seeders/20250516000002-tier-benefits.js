"use strict";

const { v4: uuidv4 } = require("uuid");

/** @type {import('sequelize-cli').Migration} */
module.exports = {
  async up(queryInterface, Sequelize) {
    // Use the tier IDs from the previous seeder
    const tierIds = global.tierIds || {
      featherweight: "00000000-0000-0000-0000-000000000001",
      lightweight: "00000000-0000-0000-0000-000000000002",
      welterweight: "00000000-0000-0000-0000-000000000003",
      heavyweight: "00000000-0000-0000-0000-000000000004",
      champion: "00000000-0000-0000-0000-000000000005",
    };

    const now = new Date();

    await queryInterface.bulkInsert("tier_benefits", [
      // Featherweight benefits (Tier 1: $0-$1499)
      {
        id: uuidv4(),
        tier_id: tierIds.featherweight,
        name: "Welcome Gift",
        description: "One-time welcome gift for new members",
        benefit_type: "one_time_gift",
        benefit_value: JSON.stringify({ gift_type: "deck_box" }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.featherweight,
        name: "Birthday Discount",
        description: "Special discount during birthday month",
        benefit_type: "birthday_discount",
        benefit_value: JSON.stringify({ percentage: 15 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.featherweight,
        name: "Quarterly Discount",
        description: "Quarterly discount on any purchase",
        benefit_type: "quarterly_discount",
        benefit_value: JSON.stringify({ percentage: 10, limit: 100 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.featherweight,
        name: "Free Shipping",
        description: "Free shipping on orders over $50",
        benefit_type: "free_shipping",
        benefit_value: JSON.stringify({ min_order: 50 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },

      // Lightweight benefits
      {
        id: uuidv4(),
        tier_id: tierIds.lightweight,
        name: "Welcome Gift",
        description: "One-time welcome gift for new members",
        benefit_type: "one_time_gift",
        benefit_value: JSON.stringify({ gift_type: "playmat" }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.lightweight,
        name: "Birthday Discount",
        description: "Special discount during birthday month",
        benefit_type: "birthday_discount",
        benefit_value: JSON.stringify({ percentage: 20 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.lightweight,
        name: "Quarterly Discount",
        description: "Quarterly discount on any purchase",
        benefit_type: "quarterly_discount",
        benefit_value: JSON.stringify({ percentage: 15, limit: 150 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.lightweight,
        name: "Free Shipping",
        description: "Free shipping on all orders",
        benefit_type: "free_shipping",
        benefit_value: JSON.stringify({ min_order: 0 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.lightweight,
        name: "Early Access",
        description: "Early access to new releases",
        benefit_type: "early_access",
        benefit_value: JSON.stringify({ days_early: 1 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },

      // Welterweight benefits
      {
        id: uuidv4(),
        tier_id: tierIds.welterweight,
        name: "Welcome Gift",
        description: "One-time welcome gift for new members",
        benefit_type: "one_time_gift",
        benefit_value: JSON.stringify({ gift_type: "premium_binder" }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.welterweight,
        name: "Birthday Discount",
        description: "Special discount during birthday month",
        benefit_type: "birthday_discount",
        benefit_value: JSON.stringify({ percentage: 25 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.welterweight,
        name: "Quarterly Discount",
        description: "Quarterly discount on any purchase",
        benefit_type: "quarterly_discount",
        benefit_value: JSON.stringify({ percentage: 20, limit: 200 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.welterweight,
        name: "Free Shipping",
        description: "Free shipping on all orders",
        benefit_type: "free_shipping",
        benefit_value: JSON.stringify({ min_order: 0 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.welterweight,
        name: "Early Access",
        description: "Early access to new releases",
        benefit_type: "early_access",
        benefit_value: JSON.stringify({ days_early: 2 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.welterweight,
        name: "Exclusive Events",
        description: "Access to exclusive in-store events",
        benefit_type: "exclusive_events",
        benefit_value: JSON.stringify({ event_type: "standard" }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },

      // Heavyweight benefits
      {
        id: uuidv4(),
        tier_id: tierIds.heavyweight,
        name: "Welcome Gift",
        description: "One-time welcome gift for new members",
        benefit_type: "one_time_gift",
        benefit_value: JSON.stringify({ gift_type: "limited_edition_item" }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.heavyweight,
        name: "Birthday Discount",
        description: "Special discount during birthday month",
        benefit_type: "birthday_discount",
        benefit_value: JSON.stringify({ percentage: 40 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.heavyweight,
        name: "Quarterly Discount",
        description: "Quarterly discount on any purchase",
        benefit_type: "quarterly_discount",
        benefit_value: JSON.stringify({ percentage: 30, limit: 300 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.heavyweight,
        name: "Free Shipping",
        description: "Free overnight shipping on all orders",
        benefit_type: "free_shipping",
        benefit_value: JSON.stringify({ min_order: 0, overnight: true }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.heavyweight,
        name: "Early Access",
        description: "Early access to new releases",
        benefit_type: "early_access",
        benefit_value: JSON.stringify({ days_early: 5 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.heavyweight,
        name: "Exclusive Events",
        description: "Access to exclusive in-store events",
        benefit_type: "exclusive_events",
        benefit_value: JSON.stringify({ event_type: "vip" }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.heavyweight,
        name: "Personal Shopper",
        description: "Personal shopping assistance",
        benefit_type: "personal_shopper",
        benefit_value: JSON.stringify({ appointments_per_year: 4 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.heavyweight,
        name: "Concierge Service",
        description: "Dedicated concierge for special requests",
        benefit_type: "concierge",
        benefit_value: JSON.stringify({ priority: "highest" }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },

      // Reigning Champion benefits (Tier 5: Invite Only)
      {
        id: uuidv4(),
        tier_id: tierIds.champion,
        name: "Welcome Gift",
        description: "One-time welcome gift for champion members",
        benefit_type: "one_time_gift",
        benefit_value: JSON.stringify({
          gift_type: "exclusive_champion_collection",
        }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.champion,
        name: "Birthday Gift",
        description: "Special gift during birthday month",
        benefit_type: "birthday_gift",
        benefit_value: JSON.stringify({ gift_value: 250 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.champion,
        name: "Unlimited Discount",
        description: "Year-round discount on all purchases",
        benefit_type: "unlimited_discount",
        benefit_value: JSON.stringify({ percentage: 15 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.champion,
        name: "Free Premium Shipping",
        description: "Free priority overnight shipping on all orders",
        benefit_type: "free_shipping",
        benefit_value: JSON.stringify({
          min_order: 0,
          priority_overnight: true,
        }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.champion,
        name: "Exclusive Preview Access",
        description: "Exclusive preview access to new releases",
        benefit_type: "early_access",
        benefit_value: JSON.stringify({ days_early: 14 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.champion,
        name: "Champion Events",
        description: "Access to champion-only events",
        benefit_type: "exclusive_events",
        benefit_value: JSON.stringify({ event_type: "champion" }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.champion,
        name: "Dedicated Personal Shopper",
        description: "Dedicated personal shopping assistant",
        benefit_type: "personal_shopper",
        benefit_value: JSON.stringify({ unlimited: true }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.champion,
        name: "Champion Concierge",
        description: "24/7 dedicated concierge for any requests",
        benefit_type: "concierge",
        benefit_value: JSON.stringify({ priority: "champion", hours: "24/7" }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.champion,
        name: "Store After Hours",
        description: "Private after-hours shopping experience",
        benefit_type: "after_hours",
        benefit_value: JSON.stringify({ sessions_per_year: 4 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
      {
        id: uuidv4(),
        tier_id: tierIds.champion,
        name: "Annual Champion Gift",
        description: "Annual exclusive gift for champion members",
        benefit_type: "annual_gift",
        benefit_value: JSON.stringify({ gift_value: 500 }),
        is_active: true,
        created_at: now,
        updated_at: now,
      },
    ]);
  },

  async down(queryInterface, Sequelize) {
    await queryInterface.bulkDelete("tier_benefits", null, {});
  },
};
